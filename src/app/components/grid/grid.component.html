<div class="relative flex-1 bg-gray-100 overflow-auto w-full h-full" *mobxAutorun (click)="handleCanvasClick()">
    <canvas #gridCanvas class="absolute top-0 left-0 w-full h-full"></canvas>

    <!-- Display all tables with position adjusted for pan offset and zoom -->
    <div class="table-container" [style.transform]="'translate(' + store.panOffset.x + 'px, ' + store.panOffset.y + 'px) scale(' + store.zoomLevel / 100 + ')'">
      <!-- Tables from MobX store -->
      <div *ngFor="let table of layoutStore.elements" 
           (mousedown)="selectTable(table, $event)"
           class="selection-container"
           [class.draggable]="toolStore.activeTool !== ToolType.RoundTable"
           [class.dragging]="dragStore.isDragging && dragStore.draggedItem?.id === table.id">
        <!-- Rectangular selection indicator that includes table and chairs -->
        <div *ngIf="selectionStore.isItemSelected(table.id)" 
             class="selection-indicator table-selection"
             [style.width]="(table.radius * 2 + 80) + 'px'"
             [style.height]="(table.radius * 2 + 80) + 'px'"
             [style.transform]="'translate(-50%, -50%)'"
             [style.left]="table.x + 'px'"
             [style.top]="table.y + 'px'">
        </div>
        
        <app-round-table 
          [x]="table.x" 
          [y]="table.y" 
          [radius]="table.radius" 
          [seats]="table.seats"
          [openSpaces]="table.openSpaces" 
          [name]="table.name"
          [class.selected]="selectionStore.isItemSelected(table.id)">
        </app-round-table>
      </div>
      
      <!-- Preview table (semi-transparent with dashed border) -->
      <app-round-table 
        *ngIf="previewTable && toolStore.activeTool === ToolType.RoundTable"
        [x]="previewTable.x" 
        [y]="previewTable.y" 
        [radius]="previewTable.radius" 
        [seats]="previewTable.seats" 
        [name]="previewTable.name"
        class="opacity-70 preview-table">
      </app-round-table>
    </div>

    <!-- Show cursor as crosshair when in add mode -->
    <div *ngIf="toolStore.activeTool === ToolType.RoundTable" 
         class="absolute top-0 left-0 w-full h-full cursor-crosshair"></div>

    <div class="absolute bottom-4 right-4 flex flex-col items-end gap-2 z-10">
        <div class="bg-white/90 px-2 py-1 rounded text-xs shadow">
          X: {{ store.getUnscaledCoordinate(store.mouseX - store.panOffset.x) }}, Y: {{ store.getUnscaledCoordinate(store.mouseY - store.panOffset.y) }}
        </div>
        <div class="flex items-center bg-white/90 px-2 py-1 rounded shadow">
          <button (click)="zoomIn()" class="w-6 h-6 flex items-center justify-center bg-white border border-gray-200 rounded cursor-pointer text-base transition-all duration-200 hover:bg-gray-100">+</button>
          <span class="mx-2 text-xs w-12 text-center">{{ store.zoomLevel }}%</span>
          <button (click)="zoomOut()" class="w-6 h-6 flex items-center justify-center bg-white border border-gray-200 rounded cursor-pointer text-base transition-all duration-200 hover:bg-gray-100">-</button>
        </div>
        
        <!-- Status indicators -->
        <div class="flex flex-col gap-1">
          <div class="bg-blue-500 text-white px-2 py-1 rounded text-xs shadow">
            Using MobX
          </div>
          <div *ngIf="dragStore.isDragging" class="bg-green-500 text-white px-2 py-1 rounded text-xs shadow">
            Dragging: {{ dragStore.draggedItem?.['name'] }}
          </div>
        </div>
      </div>
</div>